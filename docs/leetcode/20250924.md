---
date: 2025-09-24
category:
  - LeetCode每日一题
tag:
  - 字符串
  - 哈希表
  - 数学
---

# [166. 分数到小数](https://leetcode.cn/problems/fraction-to-recurring-decimal/)

给定两个整数，分别表示分数的分子 `numerator` 和分母 `denominator`，以 **字符串形式返回小数** 。

如果小数部分为循环小数，则将循环的部分括在括号内。

如果存在多个答案，只需返回 **任意一个** 。

对于所有给定的输入，**保证** 答案字符串的长度小于 `104` 。

 

**示例 1：**

```
输入：numerator = 1, denominator = 2
输出："0.5"
```

**示例 2：**

```
输入：numerator = 2, denominator = 1
输出："2"
```

**示例 3：**

```
输入：numerator = 4, denominator = 333
输出："0.(012)"
```

 

**提示：**

- `-231 <= numerator, denominator <= 231 - 1`
- `denominator != 0`

# 解题思路

怎么知道进入循环了？
用一个哈希表记录，哈希表的 key 是余数 r，value 是这个余数对应着第几位小数。

计算商（添加到答案），更新 r 后：

如果 r 在哈希表中，说明有循环节，根据哈希表中记录的小数位置，可以得到循环节之前的小数，以及循环节的内容。
如果 r 不在哈希表中，往哈希表中插入 r 以及此时我们在算第几位小数。
特别地，如果 r=0，说明没有循环节，退出循环。

如果我们只看小数位数字，一个数字第二次出现时，我们不知道这是循环的开始还是巧合。但**余数第二次出现时，我们确定后续会完全重复**。

```
class Solution {
public:
    string fractionToDecimal(int numerator, int denominator) {
        long long a = numerator, b = denominator;
        string sign = a * b < 0 ? "-" : "";
        a = abs(a); // 保证下面的计算过程不产生负数
        b = abs(b);

        // 计算整数部分 q 和初始余数 r
        long long q = a / b, r = a % b;
        if (r == 0) { // 没有小数部分
            return sign + to_string(q);
        }

        string ans = sign + to_string(q) + ".";
        unordered_map<long long, int> r_to_pos = {{r, ans.size()}}; // 记录初始余数对应位置
        while (r) {
            // 计算小数点后的数字 q，更新 r
            r *= 10;
            q = r / b;
            r %= b;
            ans += '0' + q;
            if (r_to_pos.contains(r)) { // 有循环节
                int pos = r_to_pos[r]; // 循环节的开始位置
                return ans.substr(0, pos) + "(" + ans.substr(pos) + ")";
            }
            r_to_pos[r] = ans.size(); // 记录余数对应位置
        }
        return ans; // 有限小数
    }
};
```

复杂度分析


- 时间复杂度：O(n)，n为答案字符串的长度

- 空间复杂度：O(n)

  
  
  
  
  
  
  
  
  
